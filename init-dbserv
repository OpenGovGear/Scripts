#/usr/bin/env bash

#this script runs once on an image where postgres and 
#git are already installed along with other housekeeping
# features like ntp. This script must identify a GIT user
#account and password with privileges over OpenGovGear, or 
#it must be built into the image itself. Must use a credential
#helper to avoid being prompted for credentials when interacting 
#remote repo. 

#The script must ask for the internal subnet ip address to receive db requests from and puts an entry in pg_hpa.conf as well as postgresql.conf, and restarts postgres to make the changes effective

#does the image this script runs on have to have ssl disabled?

echo "Enter the subnet IP address of the main CKAN server:"
read $ckanIP

#sed command to make postgresql.conf listen to all ip addresses
cd /etc/postgresql/*/main
sudo sed s/#listen_addresses = 'localhost'/listen_addresses = '*'/ postgresql.conf

#TO-DO
#sed command to put an entry into pg_hpa.conf,
#or if not feasible (should be feasible), split the file
#where the new entry ought to be, and use cat to assemble
#it all together around the required entry 

#sed s/// pg_hpa.conf

#restart postgres
sudo service postgres reload
